# Eino History 示例

本示例演示了如何使用 Eino History 包来管理对话历史记录和上下文。

## 功能特性

- 对话管理（创建、更新、归档、置顶）
- 智能过滤的历史上下文检索
- 消息历史记录追踪
- 详细的调试日志

## 环境要求

- Go 1.16 或更高版本
- 可访问的 LLM 服务（在 `config.yaml` 中配置）

## 配置说明

1. 复制 `config.yaml.example` 为 `config.yaml`：
```bash
cp config.yaml.example config.yaml
```

2. 编辑 `config.yaml` 文件，填入您的配置信息：
```yaml
llm:
  provider: "your_llm_provider"  # 例如："openai", "anthropic"
  api_key: "your_api_key"
  model: "your_model_name"      # 例如："gpt-4", "claude-2"
  temperature: 0.7
  max_tokens: 2000

history:
  storage_path: "./history"     # 存储对话历史的目录
```

## 运行示例

1. 构建并运行示例：
```bash
go run main.go
```

## 示例输出

示例将展示以下内容：
1. 创建多个不同主题的对话
2. 管理对话状态（归档、置顶）
3. 在对话中使用历史上下文
4. 详细的对话流程日志

示例日志输出：
```
===== 对话管理示例 =====
开始对话: 数学学习 (ID: abc123)
=== 处理消息 #1 ===
问题: 什么是微积分？

=== 历史对话上下文信息 ===
选择的对话标题: 编程学习
对话ID: def456
更新时间: 2024-04-15 10:30:00

历史消息内容:
[1] user: 如何学习Python？
[2] assistant: Python是一种很好的编程语言...
=== 历史对话上下文信息结束 ===

=== 最终发送给模型的消息列表 ===
[1] system: 以下是之前的一段对话，请参考这段对话来回答用户的问题：
[2] user: 如何学习Python？
[3] assistant: Python是一种很好的编程语言...
[4] user: 什么是微积分？
=== 消息列表结束 ===

回复: 微积分是数学的一个分支...
=== 消息 #1 处理完成 ===
```

## 代码结构

- `main.go`: 主程序入口和示例编排
- `conversation_management.go`: 对话管理和历史上下文处理
- `template.go`: 消息模板和格式化
- `utils.go`: 工具函数
- `simple_chat.go`: 基础聊天功能
- `attachment_example.go`: 附件处理示例

## 主要功能演示

1. **对话管理**
   - 创建新对话
   - 更新对话状态
   - 归档和置顶对话
   - 带过滤的对话列表

2. **历史上下文**
   - 智能选择历史对话
   - 基于时间的过滤（最近30天）
   - 带日志的随机选择
   - 上下文集成到提示中

3. **日志和调试**
   - 详细的对话流程日志
   - 历史上下文选择日志
   - 消息列表追踪
   - 错误处理和报告

## 故障排除

1. **配置问题**
   - 确保 `config.yaml` 配置正确
   - 检查 API 密钥和提供商设置
   - 验证存储路径权限

2. **历史存储**
   - 检查历史目录是否存在
   - 验证文件权限
   - 监控存储空间

3. **上下文集成**
   - 查看历史上下文选择日志
   - 检查提示中的消息顺序
   - 验证上下文相关性

## 贡献指南

欢迎提交问题和功能改进请求！ 